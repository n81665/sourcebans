(function(f){XF.EditorDialogCode=XF.extend(XF.EditorDialogCode,{__backup:{_init:"__init",show:"_show"},CMTV_Code_switcherH:null,CMTV_Code_defaultLanguage:null,CMTV_Code_init:!0,show:function(b){this._show(b);this.CMTV_Code_init||this.setDefaultLanguage()},afterShow:function(b){},_init:function(b){this.__init(b);this.CMTV_Code_switcherH=XF.Element.getHandler(b.$container.find('[data-xf-init="code-editor-switcher-container"]'),"code-editor-switcher-container");this.CMTV_Code_defaultLanguage=f("#editor_code_type").val();
this.CMTV_Code_init=!1;b.$container.find('[data-xf-init="code-editor-switcher-container"]').on("code-editor:init",XF.proxy(this,"setDefaultLanguage"))},submit:function(b){b.preventDefault();b=this.ed;var c=this.overlay,a=c.$container.find(".CodeMirror");if(a.length){a=a[0].CodeMirror;var d=a.getDoc();a.save();d.setValue("");a.setOption("mode","")}a=f("#editor_code_type");d=f("#editor_code_code");var e=f("#editor_code_title"),g=f("#editor_code_highlight");b.selection.restore();XF.EditorHelpers.insertCode(b,
a.val(),d.val(),{title:e.val().trim(),highlight:g.val().trim()});c.hide();d.val("");a.val(this.CMTV_Code_defaultLanguage);e.val("");g.val("")},setDefaultLanguage:function(){this.overlay.$container.find('[data-xf-init="code-editor"]').data("lang","").focus();this.CMTV_Code_switcherH.change()}});XF.EditorHelpers.insertCode=function(b,c,a,d){switch(c.toLowerCase()){case "":var e="CODE";c="";break;default:e="CODE",c=c.toLowerCase()}a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,
"&quot;").replace(/\t/g,"    ").replace(/\n /g,"\n&nbsp;").replace(/  /g,"&nbsp; ").replace(/  /g," &nbsp;").replace(/\n/g,"</p><p>");a=d.title||d.highlight?"["+e+(c?' lang="'+c+'"':"")+(d.title?' title="'+d.title+'"':"")+(d.highlight?' highlight="'+d.highlight+'"':"")+"]"+a+"[/"+e+"]":"["+e+(c?"="+c:"")+"]"+a+"[/"+e+"]";a.match(/<\/p>/i)&&(a=("<p>"+a+"</p>").replace(/<p><\/p>/g,"<p><br></p>"));b.html.insert(a)}})(jQuery);